<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Catalogue VÃ©hicules â€” Nightfall RP</title>
  <link rel="preconnect" href="https://unpkg.com" />
  <link rel="stylesheet" href="assets/css/styles.css?v=20251227" />
  <link rel="stylesheet" href="assets/css/histoire.css?v=20251226f" />
  <link rel="stylesheet" href="assets/css/enhanced.css?v=ULTRA" />
  <link rel="stylesheet" href="assets/css/ultra-effects.css?v=WOW" />  <link rel="stylesheet" href="assets/css/global-wow.css?v=ULTIMATE" />  <link rel="stylesheet" href="assets/css/mobile.css?v=20251227" />
  <script defer src="assets/js/main.js?v=20251226"></script>
  <script defer src="assets/js/lightbox.js?v=20251226d"></script>
  <script defer src="assets/js/dynamicEffects.js?v=20251226"></script>
  <script defer src="assets/js/enhanced.js?v=20251226wow"></script>
  <style>
    /* FORCE VISIBILITÃ‰ IMMÃ‰DIATE - Ã©crase tout */
    .hero, .section, .footer {
      opacity: 1 !important;
      transform: none !important;
      visibility: visible !important;
    }
    
    .vehicles-header {
      text-align: center;
      padding: 40px 20px;
      background: linear-gradient(135deg, rgba(88,101,242,0.1), rgba(138,80,214,0.1));
      border-radius: 16px;
      margin-bottom: 40px;
    }

    .vehicles-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 32px;
      padding: 0 20px;
    }

    .filter-btn {
      padding: 10px 24px;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(88,101,242,0.3);
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      text-transform: capitalize;
    }

    .filter-btn:hover {
      background: rgba(88,101,242,0.2);
      border-color: rgba(88,101,242,0.6);
      transform: translateY(-2px);
    }

    .filter-btn.active {
      background: rgba(88,101,242,0.4);
      border-color: #5865F2;
      box-shadow: 0 0 16px rgba(88,101,242,0.5);
    }

    .vehicles-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
      padding: 0 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .vehicle-card {
      background: rgba(255,255,255,0.03);
      border: 2px solid rgba(88,101,242,0.2);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s;
      cursor: pointer;
    }

    .vehicle-card:hover {
      transform: translateY(-4px);
      border-color: rgba(88,101,242,0.6);
      box-shadow: 0 8px 24px rgba(88,101,242,0.3);
    }

    .vehicle-card__image {
      width: 100%;
      height: 180px;
      object-fit: cover;
      background: rgba(0,0,0,0.3);
    }

    .vehicle-card__content {
      padding: 16px;
    }

    .vehicle-card__name {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
      margin: 0 0 8px 0;
    }

    .vehicle-card__model {
      font-size: 13px;
      color: rgba(255,255,255,0.5);
      margin: 0 0 12px 0;
      font-family: monospace;
    }

    .vehicle-card__price {
      font-size: 20px;
      font-weight: 800;
      color: #5865F2;
      text-shadow: 0 0 8px rgba(88,101,242,0.5);
    }

    .vehicle-card__category {
      display: inline-block;
      padding: 4px 12px;
      background: rgba(88,101,242,0.2);
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      margin-top: 8px;
      color: #5865F2;
    }

    .search-box {
      max-width: 600px;
      margin: 0 auto 32px;
      padding: 0 20px;
    }

    .search-box input {
      width: 100%;
      padding: 14px 20px;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(88,101,242,0.3);
      border-radius: 8px;
      color: #fff;
      font-size: 16px;
      transition: all 0.3s;
    }

    .search-box input:focus {
      outline: none;
      border-color: #5865F2;
      box-shadow: 0 0 16px rgba(88,101,242,0.3);
    }

    .search-box input::placeholder {
      color: rgba(255,255,255,0.4);
    }

    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: rgba(255,255,255,0.6);
      font-size: 18px;
    }

    .stats-summary {
      display: flex;
      justify-content: center;
      gap: 32px;
      margin-bottom: 32px;
      flex-wrap: wrap;
      padding: 0 20px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-item__value {
      font-size: 32px;
      font-weight: 800;
      color: #5865F2;
      text-shadow: 0 0 12px rgba(88,101,242,0.5);
    }

    .stat-item__label {
      font-size: 14px;
      color: rgba(255,255,255,0.6);
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <!-- Image de fond Nightfall -->
  <div class="bg-image" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; background: url('assets/img/nightfall fond.png') center/cover no-repeat; opacity: 0.15; filter: blur(0px);"></div>
  <div class="bg"></div>

  <header class="topbar">
    <a class="brand brand--enhanced" href="index.html" aria-label="Nightfall RP">
      <span class="brand__glow"></span>
      <img src="assets/img/Logo Discord AnimÃ©e.gif" alt="Discord" style="height:44px;width:44px;margin-right:10px;border-radius:12px;box-shadow:0 0 16px #5865F2,0 0 32px #5865F2;object-fit:cover;vertical-align:middle;animation:brand-discord-pulse 2s infinite alternate;" />
      <span class="brand__text">
        <span class="brand__name brand__name--epic">NIGHTFALL</span>
        <span class="brand__sub brand__sub--glow">Roleplay â€¢ FiveM</span>
      </span>
      <style>
        @keyframes brand-discord-pulse {
          0% { filter: drop-shadow(0 0 0 #5865F2); }
          100% { filter: drop-shadow(0 0 16px #5865F2) brightness(1.15); }
        }
      </style>
    </a>

    <div class="header-right">
      <button class="mobile-menu-toggle" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div class="live-counter">
        <span class="live-dot"></span>
        <span class="live-count" data-live-count>0</span>
        <span class="live-label">En ligne</span>
      </div>
      <nav class="nav" aria-label="Navigation">
        <a href="index.html">Accueil</a>
        <a href="reglement.html">RÃ¨glement</a>
        <a href="equipe.html">Ã‰quipe</a>
        <a href="vehicules.html" class="nav-active">VÃ©hicules</a>
        <a href="economie.html">Ã‰conomie</a>
        <a href="guides.html">Guides</a>
        <a href="galerie.html">Galerie</a>
        <a href="contact.html">Contact</a>
        <a class="nav__btn" href="/player">Mon Profil</a>
        <a class="nav__btn" href="/staff">Staff Panel</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="vehicles-header">
        <h1 style="font-size: 48px; margin: 0 0 16px 0; background: linear-gradient(135deg, #5865F2, #8A50D6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
          Catalogue de VÃ©hicules
        </h1>
        <p style="font-size: 18px; color: rgba(255,255,255,0.7); margin: 0;">
          DÃ©couvre tous les vÃ©hicules disponibles sur Nightfall RP
        </p>
      </div>

      <div class="stats-summary" id="statsSummary">
        <div class="stat-item">
          <div class="stat-item__value" data-total-vehicles>â€”</div>
          <div class="stat-item__label">VÃ©hicules</div>
        </div>
        <div class="stat-item">
          <div class="stat-item__value" data-total-categories>â€”</div>
          <div class="stat-item__label">CatÃ©gories</div>
        </div>
      </div>

      <div class="search-box">
        <input type="text" id="searchInput" placeholder="ðŸ” Rechercher un vÃ©hicule..." />
      </div>

      <div class="vehicles-filters" id="filtersContainer">
        <button class="filter-btn active" data-filter="all">Tous</button>
      </div>

      <div class="vehicles-grid" id="vehiclesGrid">
        <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.6);">
          Chargement des vÃ©hicules...
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer__inner">
      <div>Â© <span data-year></span> Nightfall RP</div>
      <div class="footer__links">
        <a href="reglement.html">RÃ¨glement</a>
        <a href="equipe.html">Ã‰quipe</a>
      </div>
    </div>
  </footer>

  <script>
    const yearEl = document.querySelector('[data-year]');
    if (yearEl) yearEl.textContent = String(new Date().getFullYear());

    // ========== SÃ‰CURITÃ‰: Protection contre XSS ==========
    function escapeHtml(unsafe) {
      if (typeof unsafe !== 'string') return unsafe;
      const div = document.createElement('div');
      div.textContent = unsafe;
      return div.innerHTML;
    }

    let allVehicles = [];
    let currentFilter = 'all';
    let searchQuery = '';

    async function loadVehicles() {
      try {
        const res = await fetch('/api/vehicles');
        const data = await res.json();
        allVehicles = data.vehicles || [];
        
        // Extraire les catÃ©gories uniques
        const categories = [...new Set(allVehicles.map(v => v.category).filter(Boolean))];
        
        // CrÃ©er les boutons de filtre - SÃ‰CURISÃ‰
        const filtersContainer = document.getElementById('filtersContainer');
        filtersContainer.textContent = ''; // Vider de maniÃ¨re sÃ©curisÃ©e
        
        // Bouton "Tous"
        const allBtn = document.createElement('button');
        allBtn.className = 'filter-btn active';
        allBtn.setAttribute('data-filter', 'all');
        allBtn.textContent = 'Tous';
        filtersContainer.appendChild(allBtn);
        
        categories.sort().forEach(cat => {
          const btn = document.createElement('button');
          btn.className = 'filter-btn';
          btn.dataset.filter = escapeHtml(cat);
          btn.textContent = cat; // textContent est sÃ»r
          filtersContainer.appendChild(btn);
        });

        // Ajouter les event listeners
        filtersContainer.addEventListener('click', (e) => {
          if (!e.target.classList.contains('filter-btn')) return;
          
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          e.target.classList.add('active');
          
          currentFilter = e.target.dataset.filter;
          renderVehicles();
        });

        // Stats
        document.querySelector('[data-total-vehicles]').textContent = allVehicles.length;
        document.querySelector('[data-total-categories]').textContent = categories.length;

        renderVehicles();
      } catch (err) {
        console.error('Error loading vehicles:', err);
        const grid = document.getElementById('vehiclesGrid');
        grid.textContent = ''; // Vider
        const errorDiv = document.createElement('div');
        errorDiv.className = 'no-results';
        errorDiv.textContent = 'Erreur lors du chargement des vÃ©hicules';
        grid.appendChild(errorDiv);
      }
    }

    function renderVehicles() {
      const grid = document.getElementById('vehiclesGrid');
      
      let filtered = allVehicles;
      
      // Filtre par catÃ©gorie
      if (currentFilter !== 'all') {
        filtered = filtered.filter(v => v.category === currentFilter);
      }
      
      // Filtre par recherche
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        filtered = filtered.filter(v => 
          v.name.toLowerCase().includes(query) ||
          v.model.toLowerCase().includes(query) ||
          (v.category && v.category.toLowerCase().includes(query))
        );
      }

      if (filtered.length === 0) {
        const noResults = document.createElement('div');
        noResults.className = 'no-results';
        noResults.textContent = 'Aucun vÃ©hicule trouvÃ©';
        grid.textContent = ''; // Vider de maniÃ¨re sÃ©curisÃ©e
        grid.appendChild(noResults);
        return;
      }

      // âš ï¸ SÃ‰CURITÃ‰: CrÃ©ation des Ã©lÃ©ments de maniÃ¨re sÃ»re sans innerHTML
      grid.textContent = ''; // Vider le contenu
      
      filtered.forEach(v => {
        const card = document.createElement('div');
        card.className = 'vehicle-card';
        
        const img = document.createElement('img');
        img.className = 'vehicle-card__image';
        img.src = v.image || `https://docs.fivem.net/vehicles/${escapeHtml(v.model)}.webp`;
        img.alt = escapeHtml(v.name);
        img.loading = 'lazy';
        img.onerror = function() {
          this.onerror = null;
          this.src = `https://raw.githubusercontent.com/LVRP-BEN/bl_weapons/main/vehicles/${escapeHtml(v.model)}.png`;
          this.onerror = function() {
            this.onerror = null;
            this.src = 'assets/img/placeholder-car.svg';
          };
        };
        
        const content = document.createElement('div');
        content.className = 'vehicle-card__content';
        
        const name = document.createElement('h3');
        name.className = 'vehicle-card__name';
        name.textContent = v.name; // textContent est sÃ»r
        
        const model = document.createElement('p');
        model.className = 'vehicle-card__model';
        model.textContent = v.model;
        
        const price = document.createElement('div');
        price.className = 'vehicle-card__price';
        price.textContent = `$${v.price.toLocaleString('fr-FR')}`;
        
        content.appendChild(name);
        content.appendChild(model);
        content.appendChild(price);
        
        if (v.category) {
          const category = document.createElement('span');
          category.className = 'vehicle-card__category';
          category.textContent = v.category;
          content.appendChild(category);
        }
        
        card.appendChild(img);
        card.appendChild(content);
        grid.appendChild(card);
      });
    }

    // Recherche
    document.getElementById('searchInput').addEventListener('input', (e) => {
      searchQuery = e.target.value;
      renderVehicles();
    });

    loadVehicles();
  </script>
</body>
</html>
